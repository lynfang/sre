

kubectl get nodes --show-labels


kubeadm token create  --print-join-command

kubectl label node lc-ops-k8s-test-3 kubernetes.io/role=node2  ## add label for node

kubectl label node lc-ops-k8s-test-3 kubernetes.io/master=true
kubectl label node gz-p-k8s192-etcd3   kubernetes.io/role=master 

kubectl label node gz-p-k8s192-etcd3   kubernetes.io/role=master 

##  不让目标node 接受 pod

kubectl cordon  nodes node_name

kubectl taint nodes node_name key=value:NoSchedule


### k8s node  extend disk 

stop docker ; rm -rf /var/lib/docker 

more /etc/sysconfig/docker-storage-setup 

VG=vg0
DATA_SIZE=490G

exec : docker-storage-setup 


###  权限 ### 

kubectl create clusterrolebinding --user system:serviceaccount:kube-system:default kube-system-cluster-admin --clusterrole cluster-admin

### namerd ### 
namerctl  dtab  delete  --base-url http://admin.namerd.svsmesh.com  internal 

### kubectl  get  ip of svc ####

kubectl --namespace=default get svc  -o jsonpath={.items[4].spec.clusterIP}



### get role  ====  serviceaccount  

 kubectl get clusterrolebindings -o json | jq -r '
  .items[] | 
  select(
    .subjects // [] | .[] | 
    [.kind,.namespace,.name] == ["ServiceAccount","kube-system","kubernetes-dashboard"]
  ) |
  .metadata.name'



###  添加仓库的认证
kubectl create secret docker-registry harborlogin  \
--namespace=ccuat --docker-server=registry.qiaofangyun.com --docker-username=opsharbor --docker-password=Qiaofang123 --docker-email=opsharbor@placeholder.com


###  kill  pod  by force

export ETCDCTL_API=3;
for i in $(kubectl get pods -n internal | grep Terminating  | awk '{print $1}');do etcdctl del /registry/pods/internal/$i;done 


#### cp file in docker contain
kubectl cp testenv/commonservice-4135265854-0bg4j:/home/logs/logback/qf-common-service/app.log /tmp/



kubectl -n  monitor  create configmap alertmanager-templates --from-file=alertmanager-templates -o json --dry-run | kubectl -n monitor apply -f -       


####  get pod ip
kubectl describe pod  operationcenterfront-686bdc76c5-m4pk6 -n devenv    | grep IP | sed -E 's/IP:[[:space:]]+//'

{"mem":1493538,"mem.free":1187937,"processors":4,"instance.uptime":58130427,"uptime":58169348,"systemload.average":0.38,"heap.committed":1359360,"heap.init":1032192,"heap.used":171422,"heap":1864192,"nonheap.committed":136896,"nonheap.init":2496,"nonheap.used":134178,"nonheap":0,"threads.peak":246,"threads.daemon":234,"threads.totalStarted":263,"threads":246,"classes":15027,"classes.loaded":15027,"classes.unloaded":0,"gc.ps_scavenge.count":56,"gc.ps_scavenge.time":957,"gc.ps_marksweep.count":3,"gc.ps_marksweep.time":319,"gauge.servo.response.metrics":1.0,"gauge.servo.response.customer.searchcustomersimple":1171.0,"normalized.servo.rest.totaltime":0.0,"normalized.servo.rest.count":0.0,"gauge.servo.rest.min":0.0,"gauge.servo.rest.max":0.0,"gauge.servo.response.info":1.0,"gauge.servo.response.customer.listcustomerbyuuidssimple":12.0,"httpsessions.max":-1,"httpsessions.active":0}




###  access api sever  without token

kubectl proxy --address='0.0.0.0'  --accept-hosts='^*$'


